/*
 * main_cnn.c
 *
 */


#include "cnn.h"
#include <stdio.h>

//CONV 1
//THIS PART CHECKS AGAINST THE JUPYTER NOTEBOOK

/*
 * input shape: 5x5x1
 * number of kernels: 2
 * kernel size: 3x3
 */
#define INPUT_DIM_1 5
#define NUM_KERNELS_1 2
#define KERNEL_SIZE_1 3
#define INPUT_ARR_DIM_1 (INPUT_DIM_1 * INPUT_DIM_1)
#define KERNEL_ARR_DIM_1 (KERNEL_SIZE_1 * KERNEL_SIZE_1 * NUM_KERNELS_1)
#define OUTPUT_ARR_DIM_1 (INPUT_DIM_1 * INPUT_DIM_1 * NUM_KERNELS_1)

int main(void)
{
	//CONV 1

    float* input_conv_1 = (float*)malloc(INPUT_ARR_DIM_1 * sizeof(float));
    float* kernel_conv_1 = (float*)malloc(KERNEL_ARR_DIM_1 * sizeof(float));

    //for each kernel, we get a 5x5 output because we convolve every kernel with the input image and use
    //   "same" padding to pad the image
    float* result_conv_1 = (float*)malloc(OUTPUT_ARR_DIM_1 * sizeof(float));

    //Tensorflow "use bias" is true by default, so there's one bias term added to each kernel convolution output
    float* bias_conv_1 = (float*)malloc(NUM_KERNELS_1* sizeof(float));


    // we generate a test input for this convolution
    // the 2d matrix is flattened into a 1d array
    int i = 0;
    for(i=0;i<INPUT_ARR_DIM_1;i++){
    	input_conv_1[i]=1;
    }


    // we generate two test kernels for this convolution
    // these 2d matrices are also flatted into 1d arrays

    /* KERNEL 1
     * 1 2 3
     * 4 5 6
     * 7 8 9
     */

    /* KERNEL 2
     * 3 3 3
     * 3 3 3
     * 3 3 3
     */

    for(i=0;i<9;i++){
    	kernel_conv_1[2*i+1] = 3;
    }

    kernel_conv_1[0] = 1;
    kernel_conv_1[2] = 2;
    kernel_conv_1[4] = 3;
    kernel_conv_1[6] = 4;
    kernel_conv_1[8] = 5;
    kernel_conv_1[10] = 6;
    kernel_conv_1[12] = 7;
    kernel_conv_1[14] = 8;
    kernel_conv_1[16] = 9;

    //we generate two test biases

    bias_conv_1[0] = 0.5;
    bias_conv_1[1] = 1;

    conv(input_conv_1, kernel_conv_1, bias_conv_1, result_conv_1, INPUT_DIM_1, INPUT_DIM_1, 1, KERNEL_SIZE_1, NUM_KERNELS_1);

    for(i=0; i < INPUT_ARR_DIM_1; i++)
    {
    	printf("%f, %f\n", result_conv_1[2*i], result_conv_1[2*i+1]);
    }
//    // data for conv 2
//    float* input_conv_2 = (float*)malloc(50 * sizeof(float));
//    float* kernel_conv_2 = (float*)malloc(54 * sizeof(float));
//    float* result_conv_2 = (float*)malloc(75 * sizeof(float));
//    float* bias_conv_2 = (float*)malloc(3 * sizeof(float));
//    for(i=0;i<25;i++){
//    	input_conv_2[2*i]=1;
//    	input_conv_2[2*i+1]=2.5;
//    }
//
//    for(i=0;i<9;i++){
//    	kernel_conv_2[i*6+1] = 3;
//    	kernel_conv_2[i*6+2] = 5;
//    	kernel_conv_2[i*6+3] = 1;
//    	kernel_conv_2[i*6+4] = 2;
//    	kernel_conv_2[i*6+5] = 0;
//    }
//
//    kernel_conv_2[0] = 1;
//    kernel_conv_2[6] = 2;
//    kernel_conv_2[12] = 3;
//    kernel_conv_2[18] = 4;
//    kernel_conv_2[24] = 5;
//    kernel_conv_2[30] = 6;
//    kernel_conv_2[36] = 7;
//    kernel_conv_2[42] = 8;
//    kernel_conv_2[48] = 9;
//
//    bias_conv_2[0] = 0.5;
//    bias_conv_2[1] = 1;
//    bias_conv_2[2] = 2.5;
//
//    // data for pooling
//    float* input_pool_1 = (float*)malloc(32 * sizeof(float));
//    float* result_pool_1 = (float*)malloc(8 * sizeof(float));
//    for(i=0;i<16;i++){
//    	input_pool_1[2*i]=i+1;
//    }
//    for(i=0;i<4;i++){
//    	input_pool_1[2*i+1]=4.5-i;
//    }
//    for(i=4;i<8;i++){
//    	input_pool_1[2*i+1]=8.5-(i-4);
//    }
//    for(i=8;i<12;i++){
//    	input_pool_1[2*i+1]=12.5-(i-8);
//    }
//    for(i=12;i<16;i++){
//    	input_pool_1[2*i+1]=16.5-(i-12);
//    }
//
//    // data for dense
//    float* input_dense_1 = (float*)malloc(8 * sizeof(float));
//    float* kernel_dense_1 = (float*)malloc(80 * sizeof(float));
//    double* result_dense_1 = (float*)malloc(10 * sizeof(double));
//    float* bias_dense_1 = (float*)malloc(10 * sizeof(float));
//
//    input_dense_1[0] = 2;
//    input_dense_1[1] = 4.5;
//    input_dense_1[2] = 2;
//    input_dense_1[3] = 3;
//    input_dense_1[4] = 3;
//    input_dense_1[5] = 3;
//    input_dense_1[6] = 2;
//    input_dense_1[7] = 2.2;
//
//    int j;
//    for(j=0;j<10;j++){
//        for(i=0;i<8;i++){
//        	kernel_dense_1[i*10+j] = 1 + i + j*0.5;
//        }
//    }
//    for(i=0;i<10;i++){
//    	bias_dense_1[i] = i;
//    }
//
//    conv(input_conv_2, kernel_conv_2, bias_conv_2, result_conv_2, 5, 5, 2, 3, 3);
//    nn_pool(input_pool_1, result_pool_1, 4, 4, 2, 2);
////    dense(input_dense_1, kernel_dense_1, bias_dense_1, result_dense_1, 8, 10);
//
//    for(i = 0; i < 75; i++){
//        printf("%f \n", result_conv_2[i]);
//    }

    while(1);
}
